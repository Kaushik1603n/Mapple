<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Address Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <style>
        .form-container h3 {
            text-align: center;
            margin-bottom: 20px;
        }

        .btn-custom {
            background-color: #000;
            color: #fff;
            padding: 7px;
            border-radius: 10px;
        }

        .btn-custom:hover {
            background-color: #333;
        }
    </style>
</head>

<body>
    <%- include("../../views/partials/user/sidebar") %>
        <div class="content">

            <!-- <div class="d-flex justify-content-center mt-5">
                <div class="col-lg-10 col-md-12 card shadow-lg p-4">
                    <% if (false) { %>
                        <div><span>House Address :</span>
                            <span><b>
                                </b></span>
                        </div>
                        <div><span>Street Address :</span>
                            <span><b>

                                </b></span>
                        </div>
                        <div><span> Country :</span>
                            <span><b>

                                </b></span>
                        </div>
                        <div><span>City :</span>
                            <span><b>

                                </b></span>
                        </div>
                        <div><span>State :</span>
                            <span><b>

                                </b></span>
                        </div>
                        <div><span>Zip Code :</span>
                            <span><b>

                                </b></span>
                        </div>
                        <% } else { %>
                            <div><span>House Address :</span> ''</div>
                            <div><span>Street Address :</span> ''</div>
                            <div><span>Country :</span> ''</div>
                            <div><span>City :</span> ''</div>
                            <div><span>State :</span> ''</div>
                            <div><span>Zip Code :</span> ''</div>
                            <% } %>

                </div>
            </div> -->
            <div class="d-flex justify-content-center mt-5">
                <div class="col-lg-10 col-md-12 card shadow-sm p-3">
                    <h5>
                        <a class="text-decoration-none text-dark" data-bs-toggle="collapse" href="#addressDetails"
                            role="button" aria-expanded="false" aria-controls="addressDetails">
                            <i class="fa-solid fa-angle-down"></i> Address Details
                        </a>
                    </h5>

                    <!-- Loop through each address -->
                    <div class="collapse mt-3" id="addressDetails">
                        <!-- <% if (userAddress && userAddress.length> 0) { %>
                            <% userAddress.forEach((addr, index)=> { %>
                                <div class="mb-3 border-bottom pb-2 d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6>Address <%= index + 1 %>
                                        </h6>
                                        <div><span>House Address :</span>
                                            <span><b>
                                                    <%= addr.homeAddress %>
                                                </b></span>
                                        </div>
                                        <div><span>Landmark :</span>
                                            <span><b>
                                                    <%= addr.landmark %>
                                                </b></span>
                                        </div>
                                        <div><span>Name :</span>
                                            <span><b>
                                                    <%= addr.name %>
                                                </b></span>
                                        </div>
                                        <div><span>Phone Number :</span>
                                            <span><b>
                                                    <%= addr.phoneNumber %>
                                                </b></span>
                                        </div>
                                        <div><span>Country :</span>
                                            <span><b>
                                                    <%= addr.country %>
                                                </b></span>
                                        </div>
                                        <div><span>City :</span>
                                            <span><b>
                                                    <%= addr.city %>
                                                </b></span>
                                        </div>
                                        <div><span>State :</span>
                                            <span><b>
                                                    <%= addr.state %>
                                                </b></span>
                                        </div>
                                        <div><span>Zip Code :</span>
                                            <span><b>
                                                    <%= addr.zipCode %>
                                                </b></span>
                                        </div>
                                    </div>
                                    <div>
                                        <button class="btn btn-warning btn-sm me-2"
                                            onclick="editAddress('<%= JSON.stringify(addr) %>')">
                                            <i class="fa-solid fa-pen"></i> Edit
                                        </button>
                                        <button class="btn btn-danger btn-sm"
                                            onclick="deleteAddress('<%= addr._id %>')">
                                            <i class="fa-solid fa-trash"></i> Delete
                                        </button>
                                    </div>
                                </div>
                                <% }); %>
                                    <% } else { %>
                                        <p>No address available.</p>
                                        <% } %> -->
                    </div>



                </div>
            </div>

            <!-- Edit Address Modal -->
            <div class="modal fade" id="editAddressModal" tabindex="-1" aria-labelledby="editAddressModalLabel"
                aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="editAddressModalLabel">Edit Address</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <form id="editAddressForm" onsubmit="saveAddress(event)">
                            <div class="modal-body">
                                <input type="hidden" id="editAddressId">
                                <div class="mb-3">
                                    <label for="editHomeAddress" class="form-label">House Address</label>
                                    <input type="text" class="form-control" id="editHomeAddress" required>
                                </div>
                                <div class="mb-3">
                                    <label for="editLandmark" class="form-label">Landmark</label>
                                    <input type="text" class="form-control" id="editLandmark" required>
                                </div>
                                <div class="mb-3">
                                    <label for="editName" class="form-label">Name</label>
                                    <input type="text" class="form-control" id="editName" required>
                                </div>
                                <div class="mb-3">
                                    <label for="editPhoneNumber" class="form-label">Phone Number</label>
                                    <input type="text" class="form-control" id="editPhoneNumber" required>
                                </div>
                                <div class="mb-3">
                                    <label for="editCountry" class="form-label">Country</label>
                                    <input type="text" class="form-control" id="editCountry" required>
                                </div>
                                <div class="mb-3">
                                    <label for="editCity" class="form-label">City</label>
                                    <input type="text" class="form-control" id="editCity" required>
                                </div>
                                <div class="mb-3">
                                    <label for="editState" class="form-label">State</label>
                                    <input type="text" class="form-control" id="editState" required>
                                </div>
                                <div class="mb-3">
                                    <label for="editZipCode" class="form-label">Zip Code</label>
                                    <input type="text" class="form-control" id="editZipCode" required>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="submit" class="btn btn-primary">Save Changes</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>




            <div class="d-flex justify-content-center align-items-center my-5">
                <div class="form-container col-lg-10 col-md-12 card shadow-sm p-3 ">
                    <h3>Shipping Address</h3>
                    <form id="addressForm">
                        <div class="mb-3">
                            <label for="houseAddress" class="form-label">House Address</label>
                            <input type="text" class="form-control" id="houseAddress"
                                placeholder="Enter your house address">
                            <div id="houseAddressError" class="text-danger"></div>
                        </div>
                        <div class="mb-3">
                            <label for="landmark" class="form-label">Landmark</label>
                            <input type="text" class="form-control" id="landmark" placeholder="Enter a nearby landmark">
                            <div id="landmarkError" class="text-danger"></div>

                        </div>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="name" class="form-label">Name</label>
                                <input type="text" class="form-control" id="name" placeholder="Enter your Name">
                                <div id="nameError" class="text-danger"></div>
                            </div>
                            <div class="col-md-6">
                                <label for="phoneNumber" class="form-label">Phone Number</label>
                                <input type="text" class="form-control" id="phoneNumber"
                                    placeholder="Enter your phone number">
                                <div id="phoneNumberError" class="text-danger"></div>
                            </div>
                        </div>
                        <div class="row g-3  mt-3">
                            <div class="col-md-6">
                                <label for="city" class="form-label">City</label>
                                <input type="text" class="form-control" id="city" placeholder="City">
                                <div id="cityError" class="text-danger"></div>
                            </div>
                            <div class="col-md-6">
                                <label for="state" class="form-label">State</label>
                                <input type="text" class="form-control" id="state" placeholder="State">
                                <div id="stateError" class="text-danger"></div>
                            </div>
                        </div>
                        <div class="row g-3 mt-3">
                            <div class="col-md-6">
                                <label for="zipCode" class="form-label">Zip Code</label>
                                <input type="text" class="form-control" id="zipCode" placeholder="Zip Code">
                                <div id="zipCodeError" class="text-danger"></div>
                            </div>
                            <div class="col-md-6">
                                <label for="country" class="form-label">Country</label>
                                <input type="text" class="form-control" id="country" placeholder="Country">
                                <div id="countryError" class="text-danger"></div>
                            </div>
                        </div>
                        <div class="d-grid mt-4">
                            <button type="submit" class="btn btn-primary">Change Address</button>
                        </div>
                    </form>

                </div>
            </div>

        </div>
        <script src="/js/address.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <!-- <script>
            document.querySelector('[data-bs-toggle="collapse"]').addEventListener('click', function () {
                const icon = this.querySelector('i');
                if (icon.classList.contains('fa-angle-down')) {
                    icon.classList.remove('fa-angle-down');
                    icon.classList.add('fa-angle-up');
                } else {
                    icon.classList.remove('fa-angle-up');
                    icon.classList.add('fa-angle-down');
                }
            });

            document.getElementById('addressForm').addEventListener('submit', async (event) => {
                event.preventDefault(); // Prevent default form submission

                // Retrieve form values
                const homeAddress = document.getElementById('houseAddress').value.trim();
                const landmark = document.getElementById('landmark').value.trim();
                const name = document.getElementById('name').value.trim();
                const phoneNumber = document.getElementById('phoneNumber').value.trim();
                const city = document.getElementById('city').value.trim();
                const state = document.getElementById('state').value.trim();
                const zipCode = document.getElementById('zipCode').value.trim();
                const country = document.getElementById('country').value.trim();

                // Error elements
                const errors = {
                    houseAddressError: document.getElementById('houseAddressError'),
                    landmarkError: document.getElementById('landmarkError'),
                    nameError: document.getElementById('nameError'),
                    phoneNumberError: document.getElementById('phoneNumberError'),
                    cityError: document.getElementById('cityError'),
                    stateError: document.getElementById('stateError'),
                    zipCodeError: document.getElementById('zipCodeError'),
                    countryError: document.getElementById('countryError'),
                };

                // Clear previous errors
                for (const key in errors) {
                    errors[key].textContent = '';
                }

                // Validation
                let isValid = true;

                if (!homeAddress) {
                    errors.houseAddressError.textContent = 'House address is required.';
                    isValid = false;
                }
                if (!landmark) {
                    errors.landmarkError.textContent = 'Landmark is required.';
                    isValid = false;
                }
                if (!name) {
                    errors.nameError.textContent = 'Name is required.';
                    isValid = false;
                }
                if (!phoneNumber || !/^\d{10}$/.test(phoneNumber)) {
                    errors.phoneNumberError.textContent = 'Enter a valid 10-digit phone number.';
                    isValid = false;
                }
                if (!city) {
                    errors.cityError.textContent = 'City is required.';
                    isValid = false;
                }
                if (!state) {
                    errors.stateError.textContent = 'State is required.';
                    isValid = false;
                }
                if (!zipCode || !/^\d{6}$/.test(zipCode)) {
                    errors.zipCodeError.textContent = 'Enter a valid 6-digit zip code.';
                    isValid = false;
                }
                if (!country) {
                    errors.countryError.textContent = 'Country is required.';
                    isValid = false;
                }

                // Stop if any validation fails
                if (!isValid) return;

                // Prepare data for sending
                const formData = {

                    homeAddress,
                    landmark,
                    name,
                    phoneNumber,
                    city,
                    state,
                    zipCode,
                    country,
                };

                try {
                    // Send data to the server
                    const response = await fetch('/user/addAddress', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(formData),
                    });

                    const result = await response.json();

                    if (response.ok) {
                        Swal.fire({
                            title: 'Success!',
                            text: 'Address updated successfully!',
                            icon: 'success',
                            confirmButtonText: 'OK'
                        }).then(() => {
                            location.reload(); // Reload the page after confirmation
                        });
                    } else {
                        Swal.fire({
                            title: 'Error!',
                            text: `Error: ${result.message || 'Failed to update address.'}`,
                            icon: 'error',
                            confirmButtonText: 'Try Again'
                        });
                    }

                } catch (error) {
                    console.error('Error:', error);
                    Swal.fire({
                        title: 'Error!',
                        text: 'An error occurred while updating the address.',
                        icon: 'error',
                        confirmButtonText: 'OK'
                    });

                }
            });


        </script>
        <script>
            function deleteAddress(addressId) {
                if (confirm("Are you sure you want to delete this address?")) {
                    fetch(`/user/address/delete/${addressId}`, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                    })
                        .then(response => {
                            if (response.ok) {
                                Swal.fire({
                                    title: 'Success!',
                                    text: 'Address deleted successfully!',
                                    icon: 'success',
                                    confirmButtonText: 'OK'
                                }).then(() => {
                                    location.reload(); // Reload the page after the confirmation
                                });
                            } else {
                                Swal.fire({
                                    title: 'Error!',
                                    text: 'Failed to delete address.',
                                    icon: 'error',
                                    confirmButtonText: 'Try Again'
                                });
                            }

                        })
                        .catch(error => {
                            console.error("Error:", error);
                            Swal.fire({
                                title: 'Error!',
                                text: 'An error occurred. Please try again.',
                                icon: 'error',
                                confirmButtonText: 'OK'
                            });

                        });
                }
            }


            function editAddress(addressData) {
                // console.log(addressData);

                const address = JSON.parse(addressData);
                //  console.log(address);


                if (address) {
                    // Populate modal fields
                    document.getElementById("editAddressId").value = address._id;
                    document.getElementById("editHomeAddress").value = address.homeAddress;
                    document.getElementById("editLandmark").value = address.landmark;
                    document.getElementById("editName").value = address.name;
                    document.getElementById("editPhoneNumber").value = address.phoneNumber;
                    document.getElementById("editCountry").value = address.country;
                    document.getElementById("editCity").value = address.city;
                    document.getElementById("editState").value = address.state;
                    document.getElementById("editZipCode").value = address.zipCode;

                    // Show the modal
                    const editModal = new bootstrap.Modal(document.getElementById("editAddressModal"));
                    editModal.show();
                } else {
                    Swal.fire({
                        title: 'Not Found!',
                        text: 'Address not found!',
                        icon: 'warning',
                        confirmButtonText: 'OK'
                    });

                }
            }

            function saveAddress(event) {
                event.preventDefault();

                const addressId = document.getElementById("editAddressId").value;
                const updatedData = {
                    homeAddress: document.getElementById("editHomeAddress").value,
                    landmark: document.getElementById("editLandmark").value,
                    name: document.getElementById("editName").value,
                    phoneNumber: document.getElementById("editPhoneNumber").value,
                    country: document.getElementById("editCountry").value,
                    city: document.getElementById("editCity").value,
                    state: document.getElementById("editState").value,
                    zipCode: document.getElementById("editZipCode").value,
                };

                // Send updated data to the backend
                fetch(`/user/address/edit/${addressId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(updatedData),
                })
                    .then(response => {
                        if (response.ok) {
                            Swal.fire({
                                title: 'Success!',
                                text: 'Address updated successfully!',
                                icon: 'success',
                                confirmButtonText: 'OK'
                            }).then(() => {
                                location.reload(); // Reload the page after the confirmation
                            });
                        } else {
                            Swal.fire({
                                title: 'Error!',
                                text: 'Failed to update address.',
                                icon: 'error',
                                confirmButtonText: 'Try Again'
                            });
                        }

                    })
                    .catch(error => {
                        console.error("Error:", error);
                        Swal.fire({
                            title: 'Error!',
                            text: 'An error occurred. Please try again.',
                            icon: 'error',
                            confirmButtonText: 'OK'
                        });

                    });
            }
        </script> -->

</body>

</html>