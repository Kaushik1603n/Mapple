<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="/stylesheet/productDetails.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css"
        integrity="sha512-5Hs3dF2AEPkpNAR7UiOHba+lRSJNeM2ECkwxUIxC1Q/FLycGTbNapWXB4tP889k5T5Ju8fs4b1P5z/iB4nMfSQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>
    <%- include("../../views/partials/user/header") %>

        <!-- Product Details Section -->
        <main class=" pt-5">
            <div class="container mt-5 ">
                <div class="row">
                    <div class="col-lg-6 text-center">
                        <div id="productCarousel" class="carousel slide zoom-wrapper">
                            <div class="carousel-inner">
                                <% productDetails.productImage.forEach((image, index)=> { %>
                                    <div class="carousel-item <%= index === 0 ? 'active' : '' %>">
                                        <img src="<%= image %>" class="d-block w-100 img-fluid zoom-image"
                                            alt="Product Image <%= index + 1 %>">
                                    </div>
                                    <% }); %>
                            </div>
                            <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel"
                                data-bs-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Previous</span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#productCarousel"
                                data-bs-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Next</span>
                            </button>
                        </div>

                        <div class="d-flex justify-content-center mt-3">
                            <% productDetails.productImage.forEach((image, index)=> { %>
                                <img src="<%= image %>" class="img-thumbnail mx-2" style="width: 60px; height: 40px;"
                                    alt="Thumbnail <%= index + 1 %>" onclick="switchToSlide('<%= index %>')">
                                <% }); %>
                        </div>

                    </div>

                    <!-- Product Details -->
                    <div class="col-lg-6">
                        <h1>
                            <%= productDetails.productName %>
                                <%= productDetails.variant %>
                                    (<%= productDetails.processor %>)
                        </h1>

                        <p class="text-dark fw-bold fs-4">
                            <span>&#8377;</span>
                             <%= productDetails.salePrice %>
                                <span class="text-muted fs-6 ms-2" style="text-decoration: line-through;">
                                    <%= productDetails.regularPrice %>
                                </span>
                                <span class="text-muted fs-6">(Incl. of all taxes)</span>
                        </p>


                        <h6>Available Variants</h6>
                        <div>
                            <% availableVariants.forEach(variant=> { %>
                                <button
                                    class="btn btn-outline-secondary me-2  <% if (activeVariant === variant) { %>active<% } %>"
                                    onclick="updateProductDetails(null, '<%= variant %>')">
                                    <%= variant %>
                                </button>
                                <% }); %>
                        </div>

                        <h6 class="mt-2">Available Colors</h6>
                        <div>

                            <% availableColors.forEach((color)=> { %>
                                <span class="badge me-2 p-2 colorBadge <% if (activeColor === color) { %>active<% } %>"
                                    data-color="<%= color %>" onclick="updateProductDetails('<%= color %>', null)">
                                    <%= color %>
                                </span>
                                <% }); %>

                        </div>

                        <div class="d-flex align-items-center mt-4">
                            <button class="btn btn-outline-secondary me-2" id="decreaseButton">-</button>
                            <input type="text" value="1" class="form-control text-center w-25 me-2" id="quantityInput"
                                readonly>
                            <button class="btn btn-outline-secondary me-3" id="increaseButton">+</button>
                        </div>

                        <div class="product-buttons">
                            <button class="btn btn-primary" id="addToCartButton">Add to Cart</button>
                            <button class="btn btn-secondary" id="addToWishlistButton">Add to Wishlist</button>
                        </div>
                    </div>

                </div>
            </div>
        </main>

        <%- include("../../views/partials/user/footer") %>


            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
                crossorigin="anonymous"></script>
            <script>
                // Function to switch to a specific slide in the carousel
                function switchToSlide(slideIndex) {
                    const carousel = new bootstrap.Carousel('#productCarousel');
                    carousel.to(slideIndex);
                }

                // Get references to the buttons and input field for quantity change
                const decreaseButton = document.getElementById('decreaseButton');
                const increaseButton = document.getElementById('increaseButton');
                const quantityInput = document.getElementById('quantityInput');

                // Set the initial quantity
                let quantity = 1;

                // Add event listener for the decrease button
                decreaseButton.addEventListener('click', function () {
                    if (quantity > 1) {
                        quantity--; // Decrease quantity only if it's greater than 1
                        quantityInput.value = quantity; // Update the input field
                    }
                });

                // Add event listener for the increase button
                increaseButton.addEventListener('click', function () {
                    quantity++; // Increase quantity
                    quantityInput.value = quantity; // Update the input field
                });

                // Select all the storage buttons
                const storageButtons = document.querySelectorAll('button[data-storage]');

                // Add event listener for each storage button
                storageButtons.forEach(button => {
                    button.addEventListener('click', function () {
                        // Remove the 'active' class from all buttons
                        storageButtons.forEach(b => b.classList.remove('active'));

                        // Add the 'active' class to the clicked button
                        button.classList.add('active');

                        // Optionally, store the selected storage size
                        const selectedStorage = button.getAttribute('data-storage');
                        console.log('Selected Storage:', selectedStorage); // Use this value as needed
                    });
                });

                // Select all badges
                const colorBadges = document.querySelectorAll('.badge');

                // Add click event listener to each badge
                colorBadges.forEach(badge => {
                    badge.addEventListener('click', function () {
                        // Remove 'active' class from all badges
                        colorBadges.forEach(b => b.classList.remove('active'));

                        // Add 'active' class to the clicked badge
                        this.classList.add('active');

                        // Optionally, you can get the selected color for further use
                        const selectedColor = this.getAttribute('data-color');
                        console.log('Selected Color:', selectedColor); // Use this value as needed
                    });
                });

                function updateProductDetails(color, variant) {
                    const url = new URL(window.location.href);
                    if (color) url.searchParams.set('color', color);
                    if (variant) url.searchParams.set('variant', variant);
                    window.location.href = url.toString();
                }

                // Function to dynamically set the background color
                document.addEventListener("DOMContentLoaded", () => {
                    const badges = document.querySelectorAll(".colorBadge");

                    badges.forEach((badge) => {
                        const color = badge.getAttribute("data-color");
                        badge.style.backgroundColor = color; // Set the background color dynamically
                    });
                });



                // function updateProductDetails(color, variant) {
                //     let url = new URL(window.location.href);

                //     if (color) {
                //         url.searchParams.set('color', color);
                //     }

                //     if (variant) {
                //         url.searchParams.set('variant', variant);
                //     }

                //     window.location.href = url.toString(); // Reload the page with updated query params
                // }

                // document.addEventListener("DOMContentLoaded", function () {
                //     // Select all color badges
                //     const colorBadges = document.querySelectorAll(".colorBadge");

                //     // Attach event listener to each badge
                //     colorBadges.forEach(badge => {
                //         badge.addEventListener("click", function () {
                //             const selectedColor = this.textContent.trim(); // Get the color from the badge
                //             updateProductDetails(selectedColor, null); // Call the function with the selected color
                //         });
                //     });
                // });



                // Function to apply zoom functionality on the image
                function applyZoom(wrapper) {
                    // Add event listeners for zoom functionality to the wrapper
                    wrapper.addEventListener("mousemove", (e) => {
                        // Find the currently active image
                        const img = wrapper.querySelector(".carousel-item.active .zoom-image");
                        if (!img) return;

                        const rect = wrapper.getBoundingClientRect();
                        const x = (e.clientX - rect.left) / rect.width;
                        const y = (e.clientY - rect.top) / rect.height;

                        img.style.transformOrigin = `${x * 100}% ${y * 100}%`;
                    });

                    wrapper.addEventListener("mouseenter", () => {
                        const img = wrapper.querySelector(".carousel-item.active .zoom-image");
                        if (img) img.classList.add("zoomed");
                    });

                    wrapper.addEventListener("mouseleave", () => {
                        const img = wrapper.querySelector(".carousel-item.active .zoom-image");
                        if (img) img.classList.remove("zoomed");
                    });
                }

                // Initialize zoom functionality for the carousel
                function initializeZoomCarousel() {
                    const zoomWrappers = document.querySelectorAll(".zoom-wrapper");

                    zoomWrappers.forEach(wrapper => {
                        // Apply zoom functionality to the wrapper
                        applyZoom(wrapper);

                        // Listen for carousel slide events to refresh zoom state
                        const carousel = wrapper.querySelector(".carousel");
                        if (carousel) {
                            carousel.addEventListener("slid.bs.carousel", () => {
                                // Ensure only the active image is affected
                                wrapper.querySelectorAll(".zoom-image").forEach(img => {
                                    img.style.transformOrigin = "";
                                    img.classList.remove("zoomed");
                                });
                            });
                        }
                    });
                }

                // Call the function to initialize everything
                initializeZoomCarousel();
            </script>
</body>

</html>