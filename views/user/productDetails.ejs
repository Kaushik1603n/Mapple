<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="/stylesheet/productDetails.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css"
        integrity="sha512-5Hs3dF2AEPkpNAR7UiOHba+lRSJNeM2ECkwxUIxC1Q/FLycGTbNapWXB4tP889k5T5Ju8fs4b1P5z/iB4nMfSQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>
    <%- include("../../views/partials/user/header") %>

        <!-- Product Details Section -->
        <main class=" pt-5">
            <div class="container mt-5 ">
                <div class="row">
                    <div class="col-lg-6 text-center">
                        <div id="productCarousel" class="carousel slide zoom-wrapper">
                            <div class="carousel-inner">
                                <% productDetails.productImage.forEach((image, index)=> { %>
                                    <div class="carousel-item <%= index === 0 ? 'active' : '' %>">
                                        <img src="<%= image %>" class="d-block w-100 img-fluid zoom-image"
                                            alt="Product Image <%= index + 1 %>">
                                    </div>
                                    <% }); %>
                            </div>
                            <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel"
                                data-bs-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Previous</span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#productCarousel"
                                data-bs-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Next</span>
                            </button>
                        </div>

                        <div class="d-flex justify-content-center mt-3">
                            <% productDetails.productImage.forEach((image, index)=> { %>
                                <img src="<%= image %>" class="img-thumbnail mx-2" style="width: 60px; height: 40px;"
                                    alt="Thumbnail <%= index + 1 %>" onclick="switchToSlide('<%= index %>')">
                                <% }); %>
                        </div>

                    </div>

                    <!-- Product Details -->
                    <div class="col-lg-6">
                        <h1>
                            <%= productDetails.productName %>
                                <%= productDetails.variant %>
                                    (<%= productDetails.processor %>)
                        </h1>

                        <p class="text-dark fw-bold fs-3 mb-0">
                            <span>&#8377;</span>
                            <%= productDetails.salePrice %>
                                <span class="text-muted fs-6 ms-2" style="text-decoration: line-through;">
                                    <%= productDetails.regularPrice %>
                                </span>
                        </p>
                        <span
                            class="fs-6 fw-bold <%= productDetails.status === 'Available' ? 'text-success' : 'text-danger' %>">(
                            <%= productDetails.status %>)
                        </span>
                        <div class="rating mb-2">
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star"></i>
                        </div>


                        <h6 class="mt-3 fw-bold">Available Variants</h6>
                        <div>
                            <% availableVariants.forEach(variant=> { %>
                                <button
                                    class="btn btn-outline-secondary me-2  <% if (activeVariant === variant) { %>active<% } %>"
                                    onclick="updateProductDetails(null, '<%= variant %>')">
                                    <%= variant %>
                                </button>
                                <% }); %>
                        </div>

                        <h6 class="mt-3 fw-bold">Available Colors</h6>
                        <div>

                            <% availableColors.forEach((color)=> { %>
                                <span class="badge me-2 p-3 colorBadge <% if (activeColor === color) { %>active<% } %>"
                                    data-color="<%= color %>" onclick="updateProductDetails('<%= color %>', null)"  style=`background-color: ${color};`>
                                    
                                </span>
                                <% }); %>

                        </div>

                        <div
                            class="<%= productDetails.status === 'Available' ? 'd-flex align-items-center mt-4' : 'd-none' %>">
                            <button class="btn btn-outline-secondary me-2" id="decreaseButton">-</button>
                            <input type="text" value="1" class="form-control text-center w-25 me-2" id="quantityInput"
                                readonly>
                            <button class="btn btn-outline-secondary me-3" id="increaseButton">+</button>
                        </div>

                        <div class="product-buttons">
                            <button class="btn btn-primary" id="addToCartButton">Add to Cart</button>
                            <button class="btn btn-secondary" id="addToWishlistButton">Add to Wishlist</button>
                        </div>
                    </div>

                </div>
            </div>

            <div class="container mt-5">
                <h3>Specifications</h3>
                <%- productDetails.description %>
            </div>

            <div class="container mt-5 mb-5">
                <h3>Reviews</h3>
                <div class="mb-3">
                    <span class="text-warning fs-4">★★★★☆</span> (4/5)
                </div>
                <ul class="list-group">
                    <li class="list-group-item">
                        <h5>Ashwin</h5>
                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
                    </li>
                    <li class="list-group-item">
                        <h5>Adharsh</h5>
                        <p>Vivamus fermentum consectetur ligula vel tristique.</p>
                    </li>
                </ul>
            </div>

            <div class="container mt-5 mb-5">
                <h3>Recommended</h3>
                <div class="row g-5">
                    <!-- Product Card -->
                    <% products.forEach(product=> { %>
                        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                            <div class="card border-0 shadow-lg text-center">
                                <div class="position-relative">
                                    <img src="<%= product.productImage[0] %>" class="card-img-top mx-auto pt-3 p-1"
                                        alt="<%= product.productName %>" style="width: 280px;">

                                    <button class="btn btn-outline-light position-absolute top-0 end-0 m-2 like-btn">
                                        <span class="like-icon">&#9825;</span>
                                    </button>
                                </div>
                                <div class="card-body">
                                    <h5 class="card-title">
                                        <%= product.productName %>
                                            <%= product.variant %>
                                    </h5>
                                    <p class="text-muted mb-2"><span>&#8377;</span>
                                        <%= product.salePrice.toLocaleString() %>
                                    </p>
                                    <div class="rating mb-3">
                                        <i class="bi bi-star-fill"></i>
                                        <i class="bi bi-star-fill"></i>
                                        <i class="bi bi-star-fill"></i>
                                        <i class="bi bi-star-fill"></i>
                                        <i class="bi bi-star"></i>
                                    </div>
                                    <a href="/user/productDetails/<%= product._id %>" class="btn btn-dark w-100">Buy
                                        Now</a>
                                </div>
                            </div>
                        </div>
                        <% }); %>

                            <div class="text-center mt-4">
                                <button id="showMoreBtn" class="btn btn-secondary px-4 py-2">Show More</button>
                            </div>
                </div>
            </div>

        </main>

        <%- include("../../views/partials/user/footer") %>


            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
                crossorigin="anonymous"></script>
            <script>
                // Function to switch to a specific slide in the carousel
                function switchToSlide(slideIndex) {
                    const carousel = new bootstrap.Carousel('#productCarousel');
                    carousel.to(slideIndex);
                }

                // Get references to the buttons and input field for quantity change
                const decreaseButton = document.getElementById('decreaseButton');
                const increaseButton = document.getElementById('increaseButton');
                const quantityInput = document.getElementById('quantityInput');

                let quantity = 1;

                decreaseButton.addEventListener('click', function () {
                    if (quantity > 1) {
                        quantity--; 
                        quantityInput.value = quantity; 
                    }
                });

                increaseButton.addEventListener('click', function () {
                    quantity++; 
                    quantityInput.value = quantity; 
                });

                // Select all the storage buttons
                const storageButtons = document.querySelectorAll('button[data-storage]');
                // Add event listener for each storage button
                storageButtons.forEach(button => {
                    button.addEventListener('click', function () {
                        storageButtons.forEach(b => b.classList.remove('active'));
                        button.classList.add('active');
                        const selectedStorage = button.getAttribute('data-storage');
                        console.log('Selected Storage:', selectedStorage); 
                    });
                });

                // Select all badges
                const colorBadges = document.querySelectorAll('.badge');
                colorBadges.forEach(badge => {
                    badge.addEventListener('click', function () {
                        colorBadges.forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                        const selectedColor = this.getAttribute('data-color');
                        console.log('Selected Color:', selectedColor); 
                    });
                });

                function updateProductDetails(color, variant) {
                    const url = new URL(window.location.href);
                    if (color) url.searchParams.set('color', color);
                    if (variant) url.searchParams.set('variant', variant);
                    window.location.href = url.toString();
                }

                // Function to dynamically set the background color
                document.addEventListener("DOMContentLoaded", () => {
                    const badges = document.querySelectorAll(".colorBadge");

                    badges.forEach((badge) => {
                        const color = badge.getAttribute("data-color");
                        badge.style.backgroundColor = color; 
                    });
                });

                // Function to apply zoom functionality on the image
                function applyZoom(wrapper) {
                    // Add event listeners for zoom functionality to the wrapper
                    wrapper.addEventListener("mousemove", (e) => {
                        // Find the currently active image
                        const img = wrapper.querySelector(".carousel-item.active .zoom-image");
                        if (!img) return;

                        const rect = wrapper.getBoundingClientRect();
                        const x = (e.clientX - rect.left) / rect.width;
                        const y = (e.clientY - rect.top) / rect.height;

                        img.style.transformOrigin = `${x * 100}% ${y * 100}%`;
                    });

                    wrapper.addEventListener("mouseenter", () => {
                        const img = wrapper.querySelector(".carousel-item.active .zoom-image");
                        if (img) img.classList.add("zoomed");
                    });

                    wrapper.addEventListener("mouseleave", () => {
                        const img = wrapper.querySelector(".carousel-item.active .zoom-image");
                        if (img) img.classList.remove("zoomed");
                    });
                }

                // Initialize zoom functionality for the carousel
                function initializeZoomCarousel() {
                    const zoomWrappers = document.querySelectorAll(".zoom-wrapper");

                    zoomWrappers.forEach(wrapper => {
                        // Apply zoom functionality to the wrapper
                        applyZoom(wrapper);

                        const carousel = wrapper.querySelector(".carousel");
                        if (carousel) {
                            carousel.addEventListener("slid.bs.carousel", () => {
                                wrapper.querySelectorAll(".zoom-image").forEach(img => {
                                    img.style.transformOrigin = "";
                                    img.classList.remove("zoomed");
                                });
                            });
                        }
                    });
                }

                initializeZoomCarousel();
            </script>
</body>

</html>